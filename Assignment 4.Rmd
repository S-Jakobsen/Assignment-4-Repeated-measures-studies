---
title: "Assignment 4"
author: "Sivert Jakobsen"
date: "11 11 2020"
output: html_document
editor_options: 
chunk_output_type: console
---
## Introduksjon 
I denne oppgaven skal jeg bruke to datasett. Til oppgave 1 bruker jeg ten_vs_thirty.xlsx hvor jeg skal svare på hva som burde være den anbefalte intensiteten for utvikling av styrke. I oppgave 2 skal jeg bruke strengthTest.csv datasettet hvor jeg skal svare på hva som burde være det anbefalte volumet for utvikling av styrke. 

```{r Packages, echo=FALSE, message=FALSE, warning=FALSE}
# Innlasting av packages 
library(tidyverse)
library(readxl)
library(lme4)
library(broom)
library(kableExtra)
library(emmeans)
library(pbkrtest)
library(readr)

```


## Del 1 - Anbefalt intensitet for utvikling av styrke 

```{r Tabell, echo=FALSE, message=FALSE, warning=FALSE}
ten_vs_thirty <- read_excel("./data/ten_vs_thirty.xlsx", na = "NA")
  
ten_vs_thirty2 <- ten_vs_thirty %>%  
  filter(exercise == "legpress", # Valg av exercise
         !is.na(load), #Fjer NA
         timepoint %in% c("pre", "post")) %>% # Velg exercise vi vil se på
  mutate(timepoint = factor(timepoint, levels = c("pre", "post"))) # Fikser rekkefølgen på timepoint 

lm1 <- lm(load ~ timepoint * group, data = ten_vs_thirty2)

conf_intervals <- confint(lm1) # Lagre konfidensintervallet i en tabell

coefs <- summary(lm1)$coef

coef_summary <- cbind(coefs, data.frame(conf_intervals))

coef_summary %>%
  kbl(caption = c("Tabell 1"),
      digits = c(3, 3, 3, 3, 3, 3),
      col.names = c("Estimate",
                    "Std.Error",
                    "T-value",
                    "P-value",
                    "2.5 %",
                    "97.5 %")) %>%
   kable_classic()

```

```{r Diagram, echo=FALSE, message=FALSE, warning=FALSE}
est <- emmeans(lm1, specs = ~ timepoint|group)

est %>%
  data.frame() %>%
  mutate(timepoint = factor(timepoint, levels = c("pre", "post"))) %>%

  ggplot(aes(timepoint, emmean, group = group, color = group) ) + 
  
  geom_errorbar(aes(ymin = lower.CL, ymax = upper.CL), 
                position = position_dodge(width = 0.2), 
                width = 0.1) +
  geom_line(position = position_dodge(width = 0.2)) +
  geom_point(position = position_dodge(width = 0.2)) +
  theme_minimal()

```

```{r Normalfordeling, echo=FALSE, message=FALSE, warning=FALSE}
# Viser normalfordeling eller ikke
qqnorm(resid(lm1)); # Plotter data 
qqline(resid(lm1)) # Legger til linjen
```


## Del 2 - Anbefalt volum for utvikling av styrke 

```{r Tabell 2, echo=FALSE, message=FALSE, warning=FALSE}

strengthtest <- read.csv("./data/strengthTests.csv", na = "NA")

st <- strengthtest %>%
  filter(exercise == "isok.240") %>%
  mutate(timepoint = factor(timepoint, levels = c("pre", "session1", "post")))

lm2 <- lm(load ~ timepoint * group, data = st)

conf_intervals2 <- confint(lm2)

coefs2 <- summary(lm2)$coef

coef_summary2 <- cbind(coefs2, data.frame(conf_intervals2))

coef_summary2 %>%
  kbl(caption = c("Tabell 2"),
      digits = c(3, 3, 3, 3, 3, 3),
      col.names = c("Estimate",
                    "Std.Error",
                    "T-value",
                    "P-value",
                    "2.5 %",
                    "97.5 %")) %>%
  kable_classic()

```

```{r Diagram 2, echo=FALSE, message=FALSE, warning=FALSE}
st2 <- emmeans(lm2, specs = ~ timepoint|group)

st2 %>%
  data.frame() %>%
  mutate(timepoint = factor(timepoint, levels = c("pre", "session1", "post"))) %>%

  ggplot(aes(timepoint, emmean, group = group, color = group) ) + 
  
  geom_errorbar(aes(ymin = lower.CL, ymax = upper.CL), 
                position = position_dodge(width = 0.2), 
                width = 0.1) +
  geom_line(position = position_dodge(width = 0.2)) +
  geom_point(position = position_dodge(width = 0.2)) +
  theme_minimal()
```

```{r Normalfordeling 2, echo=FALSE, message=FALSE, warning=FALSE}
qqnorm(resid(lm2)); # Plotter data
qqline(resid(lm2)) # Legger til linjen

```

